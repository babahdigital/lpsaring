# Worklog 2026-02-24

Ringkasan perubahan fokus pembayaran + admin tagihan.

## Perubahan Utama
- Mode pembayaran:
  - Snap (`PAYMENT_PROVIDER_MODE=snap`) tetap didukung.
  - Core API (`PAYMENT_PROVIDER_MODE=core_api`) untuk QRIS/GoPay/VA (+ ShopeePay jika channel aktif).
- URL status pembayaran user-facing distandarkan ke `/payment/status?order_id=...` (opsional: `&t=<SIGNED_TOKEN>` untuk link shareable lintas device).
  - `/payment/finish` tetap dipertahankan untuk kompatibilitas callback/legacy.
- Snap.js tidak auto-load; hanya lazy-load saat mode Snap dipakai.
- QR Code untuk Core API ditampilkan via proxy backend untuk menghindari CORS:
  - `GET /api/transactions/<order_id>/qr` (+ `?download=1`).

## Admin – Buat Tagihan
- Admin → Users → Buat Tagihan kini mendukung:
  - `qris`, `gopay`, `va`, `shopeepay`.
- Dropdown metode & bank VA di admin mengikuti setting:
  - `CORE_API_ENABLED_PAYMENT_METHODS`
  - `CORE_API_ENABLED_VA_BANKS`
- WhatsApp tagihan selalu menyertakan link status `/payment/status?order_id=...` (idealnya dengan `&t=...` agar bisa dibuka tanpa login).

## Env
- Ditambahkan dukungan env:
  - `MIDTRANS_ORDER_ID_PREFIX` (prefix transaksi user / beli)
  - `ADMIN_BILL_ORDER_ID_PREFIX` (prefix tagihan admin)

## Fix / Catatan
- Redirect guest → login kini menyertakan query `redirect=<fullPath>` agar setelah login kembali ke target (mis. status pembayaran).
- UI checklist Core API di Admin Settings di-refactor ke grid agar tidak “geser/lompat”.

## Perubahan Tambahan (UI/UX & Responsif)

### A) Admin Settings (Responsif + Konsistensi Komponen)
- Halaman admin settings di-refactor untuk konsistensi layout, label, dan spacing.
- Conditional UI untuk mode pembayaran:
  - `PAYMENT_PROVIDER_MODE=snap` → sembunyikan checklist Core API (metode pembayaran + bank VA).
  - `PAYMENT_PROVIDER_MODE=core_api` → tampilkan checklist metode, dan bank VA hanya jika VA diaktifkan.

Commit terkait (ringkas):
- `1eaf27d6`, `73aedccc`, `5574c30c`, `c9725a0d`, `1a308b49`, `354641c0`

### B) Layout Mobile (Admin & User) — Selaras Lebar, Tidak Ada Horizontal Scroll
- Mobile width diselaraskan agar halaman user dashboard/akun/riwayat terasa selebar /admin.
- Akar masalah utama: padding bertumpuk antara layout wrapper dan `VContainer` (Vuetify) di beberapa halaman user.
- Spacing navbar diperbaiki agar ikon hamburger dan avatar tidak menempel tepi.

Commit terkait (ringkas):
- `c3b451b5`, `c57c47a1`, `d47dc7e3`, `9611d322`
