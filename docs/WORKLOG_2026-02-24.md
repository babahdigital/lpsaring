# Worklog 2026-02-24

Ringkasan perubahan fokus pembayaran + admin tagihan.

## Perubahan Utama
- Mode pembayaran:
  - Snap (`PAYMENT_PROVIDER_MODE=snap`) tetap didukung.
  - Core API (`PAYMENT_PROVIDER_MODE=core_api`) untuk QRIS/GoPay/VA (+ ShopeePay jika channel aktif).
- URL status pembayaran user-facing distandarkan ke `/payment/status?order_id=...`.
  - `/payment/finish` tetap dipertahankan untuk kompatibilitas callback/legacy.
- Snap.js tidak auto-load; hanya lazy-load saat mode Snap dipakai.
- QR Code untuk Core API ditampilkan via proxy backend untuk menghindari CORS:
  - `GET /api/transactions/<order_id>/qr` (+ `?download=1`).

## Admin – Buat Tagihan
- Admin → Users → Buat Tagihan kini mendukung:
  - `qris`, `gopay`, `va`, `shopeepay`.
- Dropdown metode & bank VA di admin mengikuti setting:
  - `CORE_API_ENABLED_PAYMENT_METHODS`
  - `CORE_API_ENABLED_VA_BANKS`
- WhatsApp tagihan selalu menyertakan link status `/payment/status?order_id=...`.

## Env
- Ditambahkan dukungan env:
  - `MIDTRANS_ORDER_ID_PREFIX` (prefix transaksi user / beli)
  - `ADMIN_BILL_ORDER_ID_PREFIX` (prefix tagihan admin)

## Fix / Catatan
- Redirect guest → login kini menyertakan query `redirect=<fullPath>` agar setelah login kembali ke target (mis. status pembayaran).
- UI checklist Core API di Admin Settings di-refactor ke grid agar tidak “geser/lompat”.
