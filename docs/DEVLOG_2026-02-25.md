# Devlog 2026-02-25 (Stabilisasi Produksi + UX Dialog + Admin Users/Pagination)

Dokumen ini merangkum pekerjaan berdasarkan **commit history**, feedback produksi, dan langkah troubleshooting: masalah yang muncul, akar masalah, solusi, dan cara verifikasi.

> Catatan keamanan: tidak ada token/secret ditulis di dokumen ini.

## 1) Ringkasan

Fokus hari ini:
- Stabilisasi UX produksi setelah rilis fitur debt + Komandan.
- Perbaikan beberapa error produksi:
  - Admin edit user: saat `Unlimited Time` ON, field tambah masa aktif seharusnya tidak muncul.
  - Dashboard Komandan: chart mingguan/bulanan stuck loading.
  - Browser console spam: `Content-Security-Policy-Report-Only` (script-src 'none').
  - Background request: `POST /api/users/me/devices/bind-current` sering 403.
- Penyempurnaan UI dialog agar **fullscreen + responsif** (mobile & desktop) dan tombol close selalu di atas.
- Deploy ke Raspberry Pi dengan `--prune` dan verifikasi migrate benar-benar sukses.
- Perbaikan UI Admin Users (iteratif berdasarkan feedback):
  - Default `Tanggal Tunggakan` otomatis terisi hari ini saat toggle tunggakan diaktifkan.
  - Tambah kolom `PROFILE` (Aktif/Blocked/FUP/Habis/Expired/Unlimited) + badge Debt.
  - Penyempurnaan layout mobile/responsif (toolbar, search+button, nama panjang vs badge).
- Perbaikan bug pagination server-side: klik nomor halaman tidak jalan karena watcher mereset page.
- Penyempurnaan datepicker (Flatpickr) di dialog: posisi popup dan konsistensi ukuran.
- Housekeeping GitHub Actions: hapus cache dan sisakan 2 workflow runs terbaru.

## 2) Timeline (Commit penting)

- `2298dfe3`
  - Admin edit user: hide `Tambah Masa Aktif (Hari)` saat `Unlimited Time` aktif.
  - Dashboard: chart tidak ikut loading global yang tidak relevan.
  - Endpoint `bind-current`: tambah mode `best_effort` agar tidak 403 untuk background.
  - Nginx: hide header CSP dari upstream untuk mengurangi konflik/report-only spam.

- `c13dd4ff`
  - Dashboard user: card tunggakan hanya muncul jika ada tunggakan.
  - Dashboard user: dialog Kelola Perangkat dibuat fullscreen + toolbar close.
  - Admin: dialog edit user fullscreen + scroll-friendly (desktop & mobile).
  - Admin: dialog detail user dinamis (section tunggakan/histori tampil bila relevan).
  - Komandan: dialog request header pakai toolbar (X selalu di kanan atas).

- `bb796bd1`
  - Dokumentasi: devlog 2026-02-25 + update ops/error reference.

- `d508191a`
  - Admin Users: tambah kolom `PROFILE` + default `debt_date` saat tunggakan kuota diaktifkan.

- `fc633cbd`
  - Fix pagination: watcher tidak lagi memaksa `page=1` saat user klik nomor halaman.

- `bebf9e55`
  - Selaraskan pola fetch pagination lintas halaman admin (packages, whatsapp, profile manager).

- `d76146d4`
  - UI polish: datepicker popup (posisi/ukuran), hint switch dipendekkan, spacing tabel riwayat tunggakan manual.

- `2e09754f`
  - Admin Users: penyempurnaan layout mobile (toolbar/search/button/preview cleanup) + handling nama panjang vs badge.

## 3) Masalah Produksi & Penyelesaian

### 3.1 Admin edit user: `Unlimited Time` tapi masih ada field tambah masa aktif
**Gejala**:
- Saat admin ON `Unlimited Time`, field `Tambah Masa Aktif (Hari)` masih terlihat.

**Solusi**:
- Sembunyikan input `add_days` jika `formData.unlimited_time === true`.

**Verifikasi**:
- Buka Admin → Edit User → aktifkan `Unlimited Time` → field `Tambah Masa Aktif (Hari)` tidak terlihat.

### 3.2 Dashboard Komandan: chart stuck loading
**Gejala**:
- Loading chart mingguan/bulanan tidak selesai (terutama Komandan).

**Akar masalah**:
- Parent chart memakai `isFetching` global yang juga menghitung pending request lain (mis. weekly spending) yang tidak dipakai Komandan.

**Solusi**:
- `isFetching/hasError` mengecualikan weekly spending saat role Komandan.
- Prop `parent-loading` untuk chart dibuat spesifik per request (quota/weekly/monthly), bukan global.

**Verifikasi**:
- Login sebagai Komandan → dashboard chart tampil/keluar dari skeleton setelah request selesai.

### 3.3 CSP report-only spam `script-src 'none'`
**Gejala**:
- Console spam CSP report-only (sering terlihat di mobile).

**Akar masalah (paling umum)**:
- Ada **lebih dari satu layer** yang menyuntikkan CSP (mis. upstream/frontend/backend/edge), sehingga browser menerima CSP yang saling bertabrakan.

**Solusi di stack ini**:
- Di Nginx, hide header CSP yang datang dari upstream:
  - `proxy_hide_header Content-Security-Policy;`
  - `proxy_hide_header Content-Security-Policy-Report-Only;`

**Catatan**:
- Jika masih terjadi, sumbernya bisa dari Cloudflare/edge (di luar container nginx).

### 3.4 `POST /users/me/devices/bind-current` 403 (noise)
**Gejala**:
- Request bind-current sering 403 (terutama saat background attempt di dashboard).

**Akar masalah**:
- Binding device bisa gagal karena konteks IP/MAC tidak resolvable atau policy binding.

**Solusi**:
- Backend: dukung query `?best_effort=1` untuk mode best-effort.
  - Jika gagal binding → tetap `200` dengan `{success:false, bound:false}` (tanpa 403).
  - 403 tetap dipakai untuk kasus akun nonaktif/blocked.
- Frontend dashboard: panggil endpoint dengan `?best_effort=1`.

**Verifikasi**:
- Buka dashboard user → cek Network: bind-current tidak lagi menghasilkan 403 saat gagal binding.

## 4) Penyempurnaan UX Dialog (Fullscreen + Responsif)

Target UX:
- Mobile: dialog fullscreen, konten scroll, tombol close jelas di toolbar (kanan atas), action button lebar (`block`).
- Desktop: tetap lega (fullscreen untuk admin edit, detail), tidak ada konten terpotong.

Perubahan utama:
- Komandan RequestFormDialog: header jadi `VToolbar` agar tombol X tidak “turun” ke bawah.
- Dashboard user: DeviceManager fullscreen + toolbar.
- Admin:
  - UserEditDialog fullscreen + body scroll + actions stack di mobile.
  - UserDetailDialog fullscreen di mobile + section tunggakan/histori tampil hanya bila relevan.

## 5) Deploy Produksi (Pi) + Prune + Migrate

Deploy dilakukan via script:
- `bash ./deploy_pi.sh --host 10.10.83.2 --user abdullah --port 1983 --remote-dir /home/abdullah/sobigidul --prune`

Poin penting:
- `--prune` melakukan safe prune (container/image/network/builder) dan **tidak menghapus volumes**.
- `migrate` berjalan via service `migrate` di `docker-compose.prod.yml` (`flask db upgrade`).

Verifikasi migrate sukses:
- `MIGRATE_EXIT=0` dan `MIGRATE_STATUS=exited` untuk container `hotspot_prod_flask_migrate`.

Verifikasi health:
- Healthcheck dari dalam container nginx: `wget -qO- http://127.0.0.1/api/ping`.

## 6) Checklist (Quick)

Frontend:
- `pnpm run lint`
- `pnpm run typecheck`

Backend:
- `python -m ruff check .`
- `python -m ruff format --check .`
- `python -m pytest -q`

Produksi:
- `docker compose ps` menunjukkan backend/frontend/nginx/cloudflared running.
- `docker inspect` migrate exit code 0.
- `/api/ping` OK.

## 7) Admin Users: PROFILE + Debt + Default Tanggal Tunggakan

### 7.1 Kolom `PROFILE` + badge Debt
Tujuan:
- Di tabel Admin Users, admin bisa cepat melihat status “profil” hotspot (Aktif/Blocked/FUP/Habis/Expired/Unlimited) dan indikator hutang (Debt).

Implementasi (ringkas):
- Tambah kolom `PROFILE` di halaman Admin Users.
- `PROFILE` dihitung dari data user (mis. `mikrotik_profile_name`, kondisi kuota/expiry) dan ditampilkan sebagai chip/badge.
- Jika user punya hutang (manual/auto), tampilkan badge Debt dengan ukuran kuota (MB/GB) + tooltip nilai mentah.

Verifikasi:
- Admin → Users → tabel menampilkan kolom `PROFILE`.
- User yang blocked/unlimited/expired terlihat dari chip profile.
- User yang punya hutang menampilkan badge Debt.

### 7.2 Default `Tanggal Tunggakan` otomatis hari ini
Tujuan:
- Menghindari field tanggal kosong saat admin mengaktifkan `Tunggakan Kuota`.

Solusi:
- Saat toggle tunggakan ON dan tanggal belum diisi, set `debt_date` ke tanggal hari ini (format `YYYY-MM-DD`).

Verifikasi:
- Admin → Edit User → aktifkan toggle tunggakan → `Tanggal Tunggakan` otomatis terisi.

## 8) Fix Pagination Server-side (klik nomor halaman tidak jalan)

**Gejala**:
- Admin klik nomor halaman di pagination, tapi tabel selalu balik ke halaman 1 / tidak berubah.

**Akar masalah**:
- Watcher `options` (datatable options) sebelumnya selalu memaksa `options.page = 1` saat `options` berubah.
- Saat user klik pagination, perubahan `page` juga dianggap “options berubah”, lalu di-reset lagi.

**Solusi**:
- Pisahkan watcher:
  - `watch(options, fetch..., { deep: true })` untuk fetch saat page/itemsPerPage/sort berubah.
  - Watch search/filter saja yang mereset `page=1` lalu fetch.

**Area terdampak**:
- Admin users, whatsapp, packages, dan dialog manajemen profile.

**Verifikasi**:
- Klik nomor halaman 2/3/next → data benar-benar berubah dan page tidak auto balik ke 1.

## 9) UI Polish: Datepicker & Spacing

Perubahan:
- Flatpickr (datepicker) dibuat lebih stabil di dalam dialog/scroll container:
  - posisi popup tidak “lompat” ke atas,
  - ukuran dropdown lebih konsisten dengan input.
- Hint switch dipendekkan agar tidak makan ruang.
- Tabel “Riwayat Tunggakan Manual” di detail user diberi spacing yang lebih nyaman.

## 10) Ops: GitHub Actions Cache/Run Cleanup

Konteks:
- Storage cache GitHub Actions bisa membengkak dan memicu limit.

Yang dilakukan:
- Hapus caches via `gh api`.
- Hapus workflow runs lama dan sisakan 2 terbaru.

Catatan:
- Cache bisa muncul lagi setelah ada workflow run baru.

## 11) Update Lanjutan Sesi (Merchant Center + Demo Mode + Deploy)

### 11.1 Perubahan yang sudah diterapkan

- Frontend public merchant center ditambahkan dan dipublikasikan:
  - `/merchant-center`
  - `/merchant-center/privacy`
  - `/merchant-center/terms`
- Konten legal disesuaikan agar realistis terhadap alur pembayaran saat ini (Snap/Core API, status, invoice, dan kanal support).
- Data identitas merchant dipusatkan ke env public + runtime config:
  - `NUXT_PUBLIC_MERCHANT_NAME`
  - `NUXT_PUBLIC_MERCHANT_BUSINESS_TYPE`
  - `NUXT_PUBLIC_MERCHANT_ADDRESS`
  - `NUXT_PUBLIC_MERCHANT_SUPPORT_EMAIL`
  - `NUXT_PUBLIC_MERCHANT_SUPPORT_WHATSAPP`
- Dibuat composable terpusat untuk profil merchant agar seluruh halaman legal memakai sumber data yang sama.
- Normalisasi tampilan nomor WhatsApp merchant:
  - `+62...` / `62...` ditampilkan sebagai `0...` untuk konteks Indonesia.
  - Nomor internasional non-Indonesia tetap ditampilkan dalam format internasional.

### 11.2 Demo mode berbasis ENV (aman untuk produksi)

- Backend menambahkan kontrol demo berbasis env (tanpa hardcode di kode frontend):
  - `DEMO_MODE_ENABLED`
  - `DEMO_ALLOW_ANY_PHONE`
  - `DEMO_ALLOWED_PHONES`
  - `DEMO_BYPASS_OTP_CODE`
  - `DEMO_SHOW_TEST_PACKAGE`
  - `DEMO_PACKAGE_IDS`
- Scope bypass OTP dibatasi pada nomor yang masuk kriteria demo.
- Paket nonaktif dapat ditampilkan/dibeli untuk user demo sesuai env, tanpa membuka akses user reguler.

### 11.3 Error/kendala yang ditemui selama pengerjaan

1. **Cloudflare 1010 saat smoke test eksternal**
   - Gejala: request langsung dari lokal ke endpoint produksi terblokir.
   - Penanganan: validasi dilakukan dari konteks internal server/container.

2. **Mismatch visual dengan acuan `dev/privacy/index-1.html`**
   - Gejala: hasil awal terasa terlalu keras (shadow/border/radius).
   - Penanganan: dilakukan pass kedua untuk melunakkan style agar mendekati acuan.

3. **Issue kalender/datepicker masih belum tuntas sepenuhnya**
   - Gejala: pada kondisi tertentu popup kalender masih bisa terasa tidak konsisten.
   - Status: **known issue (open)**, perlu sesi perbaikan terfokus khusus datepicker.

### 11.4 Validasi yang sudah dijalankan

- Frontend: `pnpm lint` dan `pnpm typecheck`.
- Backend: `python -m ruff check .`.
- Deploy produksi Raspberry Pi dengan `--prune` dan health check `/api/ping` sukses.

### 11.5 Koreksi lanjutan (demo user only) + UI simplification

Perbaikan lanjutan berdasarkan feedback produksi/screenshot:

- **Masalah**: paket `Testing` nonaktif masih terlihat untuk user non-demo pada kondisi tertentu.
- **Akar masalah**: filter eksposur paket demo perlu dipastikan juga di backend berdasarkan requester yang terautentikasi.
- **Perbaikan**:
  - Backend endpoint paket publik menambahkan resolusi user dari token/cookie dan validasi eligibility demo per-user.
  - Paket nonaktif dari daftar demo hanya di-append jika requester adalah user demo yang eligible.
  - Frontend flow demo diselaraskan agar tetap mengunci pembelian non-testing untuk user demo.

Penyempurnaan UX akhir:

- Panel info mode demo yang panjang diganti menjadi badge `Demo` berwarna agar tampilan lebih simpel.
- Label tombol paket yang tidak bisa dibeli dalam mode demo diubah dari `Khusus Demo` menjadi `Disable`.
- Perubahan diterapkan di dua halaman:
  - `frontend/pages/beli/index.vue`
  - `frontend/pages/captive/beli.vue`

Commit terkait lanjutan:

- `8ead0f91` — fix visibilitas paket testing nonaktif untuk non-demo + penyederhanaan label awal.
- `ebd3f314` — simplifikasi info demo menjadi badge + update label disable.

Deploy lanjutan:

- Deploy ulang dengan prune ke production berhasil.
- Health check backend tetap OK (`/api/ping` → pong).

## 12) Hardening Lanjutan — Initiation Flow (Finalisasi)

Fokus penyempurnaan sesi lanjutan:
- Menutup gap coverage di jalur initiation setelah modularisasi transaksi selesai.

Yang ditambahkan:
- Coverage tambahan untuk `POST /transactions/initiate`:
  - reject method Core API yang tidak di-enable,
  - reuse existing transaction,
  - mismatch existing transaction vs requested method (cancel + create new).
- Coverage tambahan untuk `POST /transactions/debt/initiate`:
  - reuse existing debt transaction (Snap/Core API),
  - invalid `manual_debt_id` (`422`),
  - debt manual tidak ditemukan (`404`),
  - debt manual sudah lunas (`400`).

Verifikasi akhir (targeted regression):
- `tests/test_transaction_public_status.py`
- `tests/test_transactions_lifecycle.py`
- `tests/test_auth_verify_otp_auto_authorize.py`

Hasil: **20 passed**.

Catatan:
- Warning dependency `requests`/`urllib3`/`chardet`/`charset_normalizer` masih muncul sebagai warning non-blocking; tidak ada dampak ke hasil test flow transaksi.

## 13) Hardening Lanjutan — Standardisasi Error Envelope API

Fokus penyempurnaan tahap ini:
- Menyatukan bentuk respons error API lintas endpoint tanpa breaking change ke frontend.

Perubahan utama:
- Tambah helper terpusat `backend/app/infrastructure/http/error_envelope.py` untuk payload error standar:
  - `success: false`, `error`, `message`, `status_code`, `code`, optional `details`, `request_id`.
- Global error handlers Flask (`HTTPException` dan `Exception`) dipindah memakai helper tersebut.
- Tambah normalisasi global di hook `after_request` untuk semua respons error JSON pada path `/api`:
  - Melengkapi field yang belum ada (mis. `code`, `status_code`, `request_id`) pada endpoint legacy.
  - Menjaga field lama tetap ada agar kompatibel dengan frontend saat ini.
- Migrasi bertahap endpoint kritikal:
  - auth status token error builder,
  - transaksi initiation validation error,
  - cancel transaksi (authenticated + public).

Verifikasi targeted regression:
- `tests/test_transaction_public_status.py`
- `tests/test_transactions_lifecycle.py`
- `tests/test_auth_verify_otp_auto_authorize.py`

Hasil: **22 passed**.

## 14) Hardening Lanjutan — Dependency Lockfile Backend

Fokus:
- Mengurangi drift dependency antar environment (lokal/CI/production) dengan pin versi yang deterministik.

Perubahan:
- `backend/requirements.txt` diubah dari rentang longgar (`>=`) menjadi versi pinned (`==`) berdasarkan environment yang lolos regresi.
- Menambahkan dependency langsung yang dipakai aplikasi namun belum tercantum eksplisit:
  - `Flask-SQLAlchemy==3.1.1`
- Menambahkan pin kompatibilitas untuk warning `requests` stack pada install baru:
  - `chardet==5.2.0`

Validasi:
- Targeted regression suite tetap hijau:
  - `tests/test_transaction_public_status.py`
  - `tests/test_transactions_lifecycle.py`
  - `tests/test_auth_verify_otp_auto_authorize.py`
- Hasil: **22 passed**.

## 15) Finalisasi Reproducible Build — Docker Pakai Lockfile

Fokus:
- Memastikan image build backend selalu meng-install dependency dari lockfile penuh (termasuk transitive dependencies).

Perubahan:
- Menambahkan file `backend/requirements.lock.txt` hasil `pip freeze` dari environment tervalidasi.
- Builder stage pada Docker backend diubah untuk copy dan install dari lockfile:
  - `backend/Dockerfile`
  - `backend/Dockerfile-prod`
- `chardet` diselaraskan ke `5.2.0`, lalu lockfile diregenerasi agar kompatibel dengan stack `requests`.

Dampak:
- Build menjadi lebih deterministik lintas lokal/CI/production.
- Risiko drift transitive dependency saat rebuild image menurun signifikan.

Catatan operasional:
- Saat update dependency, regenerasi lockfile dengan:
  - `python -m pip freeze > requirements.lock.txt`

## 16) CI Guard — Cek Sinkronisasi Requirements vs Lockfile

Fokus:
- Mencegah perubahan dependency langsung di `requirements.txt` tanpa update lockfile.

Perubahan:
- Tambah skrip verifikasi: `backend/scripts/check_requirements_lock_sync.py`.
- Update workflow CI backend (`.github/workflows/ci.yml`):
  - Menjalankan checker sebelum install dependency.
  - Install dependency CI dari `backend/requirements.lock.txt` (selaras dengan Docker build).

Manfaat:
- Drift dependency lebih cepat terdeteksi saat PR, bukan setelah deploy.

## 17) Workflow Developer — Satu Perintah untuk Lockfile + Validasi

Fokus:
- Menyederhanakan operasional tim saat update dependency backend.

Perubahan:
- Tambah script utilitas: `backend/scripts/refresh_lock_and_validate.py`
- Fungsi script:
  1) regenerate `requirements.lock.txt` via `pip freeze`
  2) validasi sinkronisasi lockfile
  3) jalankan regresi targeted (opsional `--skip-tests`)

Dampak:
- Proses update dependency lebih cepat dan seragam antar developer.

Penyempurnaan CI:
- Workflow backend di `.github/workflows/ci.yml` kini memakai script ini sebagai **dependency hygiene gate** (`--skip-tests`) setelah install dari lockfile.
- Ditambahkan cache pip pada job backend CI dengan key dari `backend/requirements.lock.txt` untuk mempercepat install dependency tanpa mengubah determinisme versi.
- Ditambahkan cache `pnpm` pada job frontend CI dengan key dari `frontend/pnpm-lock.yaml` untuk mempercepat install dependency frontend.
- Ditambahkan `concurrency` workflow-level agar run CI lama otomatis dibatalkan saat ada push baru pada branch yang sama.
- Ditambahkan job deteksi perubahan path (`dorny/paths-filter`) agar job backend/frontend/docker hanya berjalan saat area terkait berubah (atau saat file workflow CI berubah).
- Ditambahkan ringkasan hasil deteksi perubahan (`backend/frontend/docker/ci`) ke log dan `GITHUB_STEP_SUMMARY` agar reviewer cepat melihat alasan job dijalankan/di-skip.

## 18) Ringkasan Final Hardening (Siap PR)

Status implementasi utama:
- Error envelope API distandarkan dengan helper terpusat + normalisasi global untuk endpoint legacy.
- Idempotency side-effect transaksi (hotspot apply) sudah dilindungi lock/done guard.
- Dependency backend sudah deterministic:
  - `requirements.txt` pinned
  - `requirements.lock.txt` dipakai Docker + CI
- CI pipeline dioptimalkan:
  - cache pip backend + cache pnpm frontend,
  - concurrency cancel stale runs,
  - path-aware job execution,
  - summary perubahan path di workflow output.

Checklist merge:
- [ ] Pastikan CI `ci.yml` hijau penuh pada PR terbaru.
- [ ] Verifikasi build image backend/frontend sukses pada job `docker-build`.
- [ ] Verifikasi tidak ada file dependency berubah tanpa sinkron lockfile.
- [ ] Review cepat perubahan API error pada endpoint yang paling sering dipakai frontend.

Checklist pasca-merge (opsional tapi direkomendasikan):
- [ ] Monitor durasi CI 3-5 run pertama untuk memastikan cache hit stabil.
- [ ] Monitor error rate endpoint auth/transactions selama 24 jam pertama.

## 19) Sweep Kompatibilitas Backend-Frontend (Lint + Type + Build)

Tujuan:
- Memvalidasi bahwa perubahan backend terbaru tetap kompatibel dengan frontend pada level compile-time dan flow kritikal.

Validasi yang dijalankan:
- Backend:
  - `ruff check backend`
  - regresi targeted transaksi/auth (`test_transaction_public_status`, `test_transactions_lifecycle`, `test_auth_verify_otp_auto_authorize`)
- Frontend:
  - `pnpm run lint`
  - `pnpm run typecheck`
  - `pnpm run build`

Temuan dan perbaikan:
- Ditemukan regresi test backend setelah auto-fix lint: simbol `settings_service` di `transactions_routes.py` hilang dan dipakai monkeypatch test.
  - Perbaikan: tambah kembali shim kompatibilitas `settings_service` pada module route.
- Ditemukan mismatch tipe frontend vs payload backend aktual:
  - `approval_status` menggunakan nilai `PENDING` pada beberapa alur.
  - Properti user tambahan (`is_demo_user`, `is_blocked`, `blocked_reason`, `mikrotik_profile_name`) dipakai di frontend.
  - `finish.vue` menggunakan status `ERROR`/`UNKNOWN` namun tipe lokal tidak konsisten.
  - Perbaikan: sinkronisasi `frontend/types/api/contracts.ts` dan konsistensi `TransactionStatusContract` di `pages/payment/finish.vue`.

Hasil akhir:
- Backend lint: lulus.
- Backend regresi targeted: lulus.
- Frontend lint: lulus.
- Frontend TypeScript check: lulus.
- Frontend build: lulus (tersisa warning SSR styles Vuetify, non-blocking dan sudah dikenal).

## 20) Finalisasi Lanjutan (P0/P1/P2) — 2026-02-26

Tujuan batch ini:
- Menutup prioritas tersisa: rerun E2E isolated, peningkatan observability request-id, dan dekomposisi lanjutan halaman status pembayaran.

Perubahan implementasi:
- Frontend observability:
  - `frontend/plugins/api.ts` menambahkan propagasi `X-Request-ID` untuk request SSR maupun client.
  - Jika request dari SSR sudah membawa `x-request-id`, nilainya diteruskan ke backend; jika tidak ada, ID baru digenerate.
- Frontend dekomposisi `finish.vue`:
  - Komponen baru: `frontend/components/payment/StatusHeader.vue`.
  - Komponen baru: `frontend/components/payment/StatusActionButtons.vue`.
  - `frontend/pages/payment/finish.vue` diringkas dengan wiring dua komponen tersebut + helper `goToHistory()`.
  - Prop typing diselaraskan agar nullability aman (`paymentMethodBadgeLabel ?? undefined`).
- Backend auth/decorator envelope:
  - Lanjutan migrasi pada `backend/app/infrastructure/http/decorators.py` untuk memakai helper error envelope terstandar pada jalur unauthorized/forbidden.

Validasi yang dijalankan:
- Frontend:
  - `pnpm lint`
  - `pnpm typecheck`
- Backend targeted regression:
  - `pytest tests/test_auth_verify_otp_auto_authorize.py tests/test_transactions_lifecycle.py tests/test_transaction_public_status.py -q`
- Isolated E2E simulation:
  - `scripts/simulate_end_to_end.ps1 -ComposeFile docker-compose.e2e.yml -ProjectName lpsaring-e2e -SkipBuild`

Hasil:
- Frontend lint: lulus.
- Frontend typecheck: lulus.
- Backend targeted regression: **22 passed**.
- Isolated E2E rerun: flow mencapai tahap akhir (`[17/17]`) dan selesai dengan output `Done`.

Catatan operasional:
- Build E2E pertama pada environment bersih tetap memakan waktu karena image/backend deps disiapkan ulang; run berikutnya akan lebih cepat jika cache layer tersedia.
