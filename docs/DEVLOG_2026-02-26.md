# Devlog 2026-02-26 (Frontend Beli Final Polish + Deploy Berulang + Klarifikasi Operasional Demo User)

Dokumen ini merangkum update lanjutan dari sesi kerja terbaru, mencakup perubahan UI halaman beli, release/deploy produksi dengan prune, serta keputusan operasional terkait user demo.

## 1) Ringkasan Eksekutif

Fokus utama hari ini:
- Final polish UI kartu paket di halaman beli (`/beli` dan `/captive/beli`) agar lebih konsisten dan nyaman.
- Perbaikan UX mobile:
  - card harga dibuat lebih lebar (tidak terlihat sempit),
  - layout mobile dikunci agar tidak bisa scroll horizontal kiri/kanan.
- Commit + push dilakukan bertahap sesuai perubahan UI.
- Deploy produksi dilakukan berulang menggunakan `deploy_pi.sh --prune` dan seluruh health check lulus.
- Klarifikasi perilaku demo user di backend:
  - mode demo adalah kontrol berbasis ENV,
  - namun user demo dapat tersimpan di DB melalui flow bypass OTP,
  - list user dapat dilihat admin/super admin (dengan filter role khusus untuk admin biasa).

## 2) Timeline Commit Terkait

Commit penting yang tercatat pada sesi lanjutan ini:
- `dd97e488` — `feat(frontend): refine beli UI, branding, legal back-nav, and transparent header/footer`
- `e29a25ff` — `refine package card state visuals and selectable badge behavior`
- `bc0cc199` — `style(frontend): adjust beli package card styling`
- `127f5ae8` — `style(frontend): improve mobile package card width and prevent horizontal scroll`

Catatan:
- Beberapa commit awal di batch ini adalah refinemen visual/UX.
- Dua commit terakhir menutup isu mobile card sempit + horizontal overflow.

## 3) Perubahan Frontend yang Diimplementasikan

Area utama:
- `frontend/pages/beli/index.vue`
- `frontend/pages/captive/beli.vue`

Perubahan styling yang sudah diterapkan:
- Penyesuaian spacing komponen (header card, status chip, action area).
- Penguatan visual card detail paket agar lebih kontras dan terbaca.
- Penyelarasan tipografi subtitle hero agar lebih konsisten.
- Perbaikan mobile-specific:
  - `overflow-x: hidden` pada container halaman.
  - `package-grid` tanpa margin negatif di mobile.
  - `package-grid-col` tanpa padding horizontal di mobile.
  - `package-card` menggunakan `max-width: 100%` di mobile.

Dampak UX:
- Card paket tampil lebih penuh (lebih lebar) pada layar kecil.
- Tidak ada lagi geser horizontal yang mengganggu saat interaksi di mobile.

## 4) Klarifikasi Operasional: Demo User

### 4.1 Sumber status demo
Status demo ditentukan oleh konfigurasi ENV (bukan kolom tetap di tabel user), termasuk:
- `DEMO_MODE_ENABLED`
- `DEMO_ALLOW_ANY_PHONE`
- `DEMO_ALLOWED_PHONES`

### 4.2 Persistensi user demo
- Ketika flow OTP bypass demo aktif dan user belum ada, backend dapat membuat record `User` baru (contoh nama fallback: `Demo User XXXX`).
- Konsekuensi: user demo bisa muncul di daftar user admin karena data memang tersimpan di DB.

### 4.3 Jika demo mode dimatikan
- Menonaktifkan demo mode **tidak otomatis menghapus** user yang sudah terbuat sebelumnya.
- User existing tetap ada sampai dilakukan tindakan manual (delete/deactivate melalui alur admin).

### 4.4 Siapa yang bisa melihat daftar user
- Endpoint list user bersifat admin-protected (`admin_required`), jadi bisa diakses admin dan super admin.
- Admin biasa tidak melihat akun super admin karena query list memfilter role `SUPER_ADMIN`.

### 4.5 Perilaku hapus user (otorisasi)
- Super admin: dapat menghapus permanen user (hard delete) sesuai aturan service.
- Admin biasa: aksi delete diproses sebagai nonaktifkan user (bukan hard delete) dan tidak bisa menarget admin lain/super admin.

## 5) Deploy Produksi (dengan Prune)

Deploy dilakukan memakai script:
- `bash ./deploy_pi.sh --host 10.10.83.2 --user abdullah --port 1983 --remote-dir /home/abdullah/sobigidul --prune`

Ringkasan hasil deploy berulang:
- File produksi tersinkron (`docker-compose.prod.yml`, `.env.prod`, `.env.public.prod`, config nginx).
- Prune berhasil menghapus resource Docker yang tidak terpakai (container/image), volume tetap dipertahankan.
- Service penting berhasil running:
  - `frontend`
  - `backend`
  - `celery_worker`
  - `celery_beat`
  - `db`
  - `redis`
  - `nginx`
  - `cloudflared`
- Readiness frontend OK.
- Health check backend OK (`/api/ping` mengembalikan `pong`).

## 6) Validasi yang Tercatat

- Validasi file frontend setelah patch mobile:
  - `frontend/pages/beli/index.vue` → no errors.
  - `frontend/pages/captive/beli.vue` → no errors.
- Repo state setelah commit/push:
  - working tree clean,
  - branch `main` sinkron dengan `origin/main`.

## 7) Risiko, Mitigasi, dan Catatan Lanjutan

Risiko rendah-menengah:
- Perubahan CSS global lokal ke halaman beli berpotensi mempengaruhi spacing elemen tertentu pada breakpoint kecil.

Mitigasi yang sudah dilakukan:
- Scope perubahan dibatasi ke 2 halaman target.
- Verifikasi sintaks dan error editor dilakukan pasca-edit.
- Deploy disertai readiness + health check.

Saran lanjutan:
- Tambahkan screenshot baseline mobile untuk `/beli` dan `/captive/beli` agar regresi visual lebih cepat terdeteksi.
- Jika diperlukan kebijakan pembersihan akun demo, buat SOP cleanup berkala (manual review + delete/deactivate sesuai role).

## 8) Penutup

Batch 2026-02-26 ditutup dengan status:
- UI mobile card beli sudah lebih proporsional dan stabil,
- deploy produksi sukses dengan `--prune`,
- dokumentasi keputusan operasional demo user sudah diperjelas,
- repo dalam kondisi bersih dan sinkron.

---

## Addendum 2026-02-26 (Hydration Stabilization Lanjutan + Legal Route Guard + Restore Operasional)

Addendum ini merangkum batch lanjutan setelah hardening utama, termasuk perbaikan mismatch hydration pada flow demo login, penguatan akses halaman legal untuk semua status akun, optimasi logout lintas role, serta operasi backup/clean deploy/restore di produksi.

### A) Frontend Hydration Stabilization (Beli + Captive + Session Timing)

Perubahan utama:
- Menurunkan risiko divergence SSR/client pada halaman beli:
  - `frontend/pages/beli/index.vue`
  - `frontend/pages/captive/beli.vue`
- Strategi yang diterapkan:
  - formatting nominal dibuat deterministik (tanpa ketergantungan locale runtime),
  - elemen sensitif hydration (payment dialog/komponen tertentu) dirender setelah hydration siap,
  - mutasi auth/session di sisi client ditunda sampai app mounted.

File pendukung:
- `frontend/utils/formatters.ts` (helper format angka/mata uang/tanggal yang konsisten SSR-client)
- `frontend/app.vue` (guard efek client setelah mounted)
- `frontend/plugins/01.auth.ts` (client init auth dipindah ke lifecycle mounted)

### B) Legal Route Guard (Privacy/Terms) Always Accessible

Masalah yang ditutup:
- User status non-ok (blocked/inactive/expired/habis/fup) sempat tetap ter-redirect dari halaman legal saat refresh/session enforcement.

Perbaikan:
- Bypass legal route dipastikan pada dua lapisan:
  - middleware global status guard,
  - enforcement status di auth store.

File terkait:
- `frontend/middleware/status-guard.global.ts`
- `frontend/store/auth.ts` (fungsi enforcement status)

Hasil:
- `/merchant-center/privacy` dan `/merchant-center/terms` tetap dapat diakses lintas status user.

### C) Logout Flow Optimization (Admin/User/Komandan)

Optimasi logout yang diterapkan di store auth:
- menambah lock `logoutInProgress` untuk mencegah double-trigger logout,
- reset flag sesi lokal (`autoLoginAttempted`, `lastStatusRedirect`, `lastAuthErrorCode`) saat logout,
- redirect target berbasis role admin (`/admin`) vs non-admin (`/login`) agar lebih konsisten.

File:
- `frontend/store/auth.ts`

Status validasi lokal:
- suite auth/middleware terkait logout & guard lulus.

### D) Regression Tests Tambahan

Coverage yang ditambahkan:
- legal-route non-redirect behavior saat status non-ok,
- sanity guard redirect pada rute non-legal tetap berlaku.

File test:
- `frontend/tests/auth-middleware.runtime.test.ts`
- `frontend/tests/status-guard.runtime.test.ts`

### E) Operasional Produksi (Backup + Clean Redeploy + Restore)

Operasi yang dijalankan:
- pembersihan backup lama terpilih dengan tetap mempertahankan dump target,
- pembuatan manual backup sebelum tindakan berisiko,
- clean remote deploy directory,
- redeploy bersih (`--clean`) diikuti deploy prune,
- restore database dari dump yang diminta (`backup_20260226_121815.dump`),
- verifikasi service status + health endpoint + scan error log.

Ringkasan hasil:
- stack produksi kembali up,
- `/api/ping` normal,
- hitungan error backend/celery dan nginx 5xx pada window monitoring bernilai 0.

### F) Commit Timeline Relevan (Batch Lanjutan)

- `69ff808b` — `fix(frontend): always allow legal privacy and terms routes`
- `74774728` — `fix(frontend): stabilize hydration and lock legal-route guard behavior`
- `e5871e38` — `fix(frontend): defer client auth/session updates until mounted`

Catatan:
- Terdapat patch lokal tambahan pada logout optimization (`frontend/store/auth.ts`) yang telah tervalidasi test pada sesi kerja ini.

---

## Addendum 2026-02-26 (Hardening FE/BE + E2E Sign-off Publish)

Addendum ini melengkapi batch pada hari yang sama untuk pekerjaan hardening arsitektur dan validasi pra-publish.

### A) Refactor/Hardening Backend

- Reconcile transaksi auth/public dipusatkan ke service tunggal:
  - `backend/app/infrastructure/http/transactions/reconcile_service.py`
- `auth_routes.py` didelegasikan ke bounded-context handlers (termasuk verify OTP):
  - `backend/app/infrastructure/http/auth_contexts/verify_otp_handlers.py`
- Helper debt dipisah dari façade transaksi:
  - `backend/app/infrastructure/http/transactions/debt_helpers.py`
- Helper Midtrans/date/QR dipisah agar façade route lebih tipis:
  - `backend/app/infrastructure/http/transactions/midtrans_helpers.py`

### B) Refactor/Hardening Frontend

- Policy guard auth/maintenance dipusatkan:
  - `frontend/utils/authRoutePolicy.ts`
  - `frontend/utils/authGuardDecisions.ts`
- Decomposition `payment/finish.vue` ke komponen presentational:
  - `StatusHeader.vue`
  - `StatusActionButtons.vue`
  - `PendingPaymentInstructions.vue`
  - `PaymentSummaryPanel.vue`

### C) Kualitas Kontrak & Observability

- Contract tests payload semantic ditambahkan:
  - `backend/tests/test_openapi_contract_payload_shapes.py`
- Structured transaction logging diperkuat, termasuk `request_id` pada jalur reconcile.
- Workspace search hygiene diperkuat:
  - `.vscode/settings.json` mengecualikan `.nuxt/.output/.nitro/node_modules/.pnpm-store`.

### D) Validasi Test (Latest)

- Backend focused regression (expanded): **33 passed**.
- Frontend focused regression (expanded): **6 files, 38 tests passed**.

### E) E2E Final Sign-off

- Script existing dijalankan penuh (isolated compose, OTP-only mode):
  - `scripts/simulate_end_to_end.ps1`
- Hasil: mencapai tahap **[17/17]** dan **Done**.
- Tidak perlu patch script E2E tambahan untuk batch ini.

### F) Kesimpulan Publish Readiness

- Batch hardening dinyatakan siap publish.
- Rekomendasi operasional tetap: monitoring 24 jam pertama (auth error rate, payment status transition, webhook success/failure ratio).

---

## Addendum 2026-02-26 (P0 Reliability Applied: Payment + Captive)

Prioritas implementasi diputuskan **keduanya**: stabilitas captive access dan reliability transaksi payment.

### A) P0 Payment Reliability — DB Fallback Idempotency

- Fallback idempotency ditambahkan saat Redis unavailable pada jalur:
  - `backend/app/infrastructure/http/transactions/idempotency.py`
- Mekanisme fallback menggunakan marker event transaksi yang sudah ada (`MIKROTIK_APPLY_SUCCESS`) untuk mencegah re-apply side-effect ketika lock Redis tidak tersedia.
- Integrasi fallback dipakai konsisten pada:
  - `backend/app/infrastructure/http/transactions/webhook_routes.py`
  - `backend/app/infrastructure/http/transactions/reconcile_service.py`
- Ditambahkan metric degradasi:
  - `payment.idempotency.redis_unavailable`

### B) P0 Captive Stability — Local Global Sync Lock Fallback

- Untuk task sinkronisasi hotspot, saat Redis lock tidak tersedia kini digunakan lock lokal per-proses (best-effort anti-overlap) pada:
  - `backend/app/services/hotspot_sync_service.py`
- Ditambahkan metric degradasi lock:
  - `hotspot.sync.lock.degraded`

### C) Regression Tests Tambahan

- Test baru untuk memastikan fallback aktif dan aman:
  - `backend/tests/test_transactions_idempotency_fallback.py`
  - `backend/tests/test_hotspot_sync_lock_fallback.py`
- Hasil validasi:
  - test fallback: **passed**
  - regression terkait lifecycle transaksi + hotspot sync: **passed**

### D) Rencana Lanjutan P1/P2

- **P1**:
  - tambah integration test duplicate webhook + public payment status token,
  - standardisasi decision branch guard status/auth frontend untuk mengurangi edge-case redirect.
- **P2**:
  - dashboard observability khusus transisi state payment dan anomali sinkronisasi hotspot,
  - refactor lanjutan modul besar per bounded context agar blast radius perubahan makin kecil.

---

## Addendum 2026-02-26 (P1 Continuation: Test & Simulation Hardened)

Fokus batch lanjutan: memperdalam coverage reliability tanpa mengubah behavior runtime utama.

### A) Backend Test Hardening

- Penguatan test webhook duplicate side-effect:
  - `backend/tests/test_transactions_lifecycle.py`
  - memastikan `session` dipropagasikan ke `begin_order_effect(...)` (kritis untuk fallback DB idempotency).
- Penguatan test public status token:
  - `backend/tests/test_transaction_public_status.py`
  - tambah skenario token hilang dan token malformed (wajib ditolak).

### B) Frontend Test Hardening

- Penguatan composable fallback transaksi:
  - `frontend/tests/payment-composables.test.ts`
  - tambah skenario fallback authenticated `403 -> public token endpoint`.

### C) Validasi Perubahan (Tests + Simulation)

- Backend regression terkait perubahan:
  - `tests/test_transactions_lifecycle.py`
  - `tests/test_transaction_public_status.py`
  - `tests/test_transactions_idempotency_fallback.py`
  - `tests/test_hotspot_sync_lock_fallback.py`
  - status: **passed**
- Frontend regression terkait perubahan:
  - `tests/payment-composables.test.ts`
  - `tests/payment-status-polling.test.ts`
  - `tests/auth-guard-decisions.test.ts`
  - status: **passed**
- Simulasi focused checks:
  - `ruff check .` → **passed**
  - focused pytest setara script transaksi → **passed**

Catatan: runner `pwsh` tidak tersedia pada terminal bash aktif, sehingga simulasi dijalankan dengan perintah ekuivalen (hasil tetap tervalidasi).

---

## Addendum 2026-02-26 (P2 Continuation: Reliability Observability Endpoint)

Penyempurnaan lanjutan difokuskan pada visibilitas operasional agar degradasi reliability bisa dipantau cepat dari API admin.

### A) Backend Observability Enhancement

- Endpoint admin metrics diperluas pada:
  - `backend/app/infrastructure/http/admin/metrics_routes.py`
- Key metrik tambahan yang kini diekspos:
  - `payment.webhook.duplicate`
  - `payment.idempotency.redis_unavailable`
  - `hotspot.sync.lock.degraded`
- Ditambahkan ringkasan sinyal reliability:
  - `reliability_signals.payment_idempotency_degraded`
  - `reliability_signals.hotspot_sync_lock_degraded`

### B) Regression Test Baru

- Test endpoint metrics admin:
  - `backend/tests/test_admin_metrics_routes.py`
- Coverage test memastikan:
  - key metrik reliability baru selalu diminta dari storage,
  - `reliability_signals` sesuai nilai metrik.

### C) Validasi Batch

- Backend tests (focused + regression) → **passed**
- Frontend regression sanity (payment/auth guards) → **passed**
- Simulation-equivalent checks:
  - `ruff check .` → **passed**
  - focused pytest setara transaksi/admin → **passed**
- VS Code errors untuk file yang diubah → **no errors**

---

## Addendum 2026-02-26 (Dashboard UI Refinement: Vuexy Cards Statistics + Analytics)

Penyempurnaan UI admin dashboard diterapkan dengan referensi gaya Vuexy `cards-statistics` dan `cards-analytics` dari paket TypeScript full-version.

### A) Implementasi UI Dashboard

- Dashboard admin diperbarui pada:
  - `frontend/pages/admin/dashboard.vue`
- Penambahan section baru **Reliability Analytics** dengan pola card Vuexy:
  - tiga `CardStatisticsHorizontal` untuk metrik reliability,
  - satu kartu ringkasan status health (`Healthy` / `Degraded`) untuk payment idempotency dan hotspot sync lock.
- Integrasi data dari endpoint admin metrics:
  - `/admin/metrics`
- Tombol refresh aktivitas kini menyegarkan data dashboard + metrics + backup count sekaligus.

### B) Utility & Test

- Utility mapping reliability metrics:
  - `frontend/utils/adminMetrics.ts`
- Unit test utility:
  - `frontend/tests/admin-metrics-utils.test.ts`

### C) Validasi

- Frontend tests:
  - `tests/admin-metrics-utils.test.ts`
  - `tests/payment-composables.test.ts`
  - `tests/auth-guard-decisions.test.ts`
  - `tests/payment-status-polling.test.ts`
  - status: **passed**
- Type safety:
  - `pnpm -s typecheck` → **passed** (warning non-blocking existing: duplicated import alias)
- Lint:
  - `pnpm -s lint` → **passed**
- VS Code errors pada file yang diubah → **no errors**

### D) Final UI Polish

- Top statistics cards pada admin dashboard diseragamkan ke komponen Vuexy `CardStatisticsHorizontal` agar konsisten dengan style `cards-statistics`.
- Interaksi hover/click disederhanakan (lebih ringan dan mudah dibaca) tanpa mengubah flow data/role guard.
- Hasil validasi ulang:
  - vitest suite terkait payment/auth/admin metrics → **passed**
  - `pnpm -s typecheck` + `pnpm -s lint` → **passed** (warning import duplikat existing, non-blocking)

### E) Final Accessibility & Readability Pass

- Urutan top operational cards disesuaikan agar prioritas cepat terbaca (pending request, akan kadaluwarsa, menunggu persetujuan, backup).
- Card interaktif kini mendukung akses keyboard (`Enter`/`Space`) pada item yang punya aksi navigasi.
- Card non-navigasi (backup count) diperlakukan sebagai non-interaktif agar tidak membingungkan.
- Header `Reliability Analytics` kini memiliki status ringkas `Overall Healthy / Needs Attention`.

Validasi penutup:
- vitest (focused suites) → **passed**
- `pnpm -s typecheck` + `pnpm -s lint` → **passed**
- VS Code problems pada file berubah → **no errors**

---

## Addendum 2026-02-26 (Hotfix Debt-Limit + Auto Unauthorized Sync)

### A) Temuan Produksi (via SSH Pi)

- Task sinkronisasi kuota berjalan, namun enforcement debt-limit di jalur periodik hanya memakai `quota_debt_auto_mb`.
- Dampak: user dengan debt manual besar (`manual_debt_mb`) tidak ikut terblok meskipun total debt melewati `QUOTA_DEBT_LIMIT_MB=500`.
- Fitur unauthorized host masih berfungsi saat command manual dijalankan, tetapi belum ada scheduler periodik otomatis.

### B) Perubahan Kode

- Debt-limit hard block diperbaiki agar memakai total debt:
  - `backend/app/services/hotspot_sync_service.py`
  - tambah helper `_resolve_quota_debt_for_limit(user)` dan gunakan helper ini pada jalur block policy.
- Tambah task Celery periodik untuk unauthorized:
  - `backend/app/tasks.py`
  - task baru `sync_unauthorized_hosts_task` menjalankan `sync-unauthorized-hosts --apply`.
- Tambah beat schedule otomatis:
  - `backend/app/extensions.py`
  - schedule `sync-unauthorized-hosts` aktif saat `ENABLE_MIKROTIK_OPERATIONS=True`.
  - env interval baru: `UNAUTHORIZED_SYNC_INTERVAL_SECONDS` (default 120 detik, minimum 30 detik).

### C) Test Tambahan

- `backend/tests/test_hotspot_sync_debt_limit.py`
  - memastikan debt-limit resolver memprioritaskan `quota_debt_total_mb` dan fallback menghitung auto+manual.
- `backend/tests/test_tasks_unauthorized_sync.py`
  - memastikan task unauthorized menjalankan `--apply` dan skip saat MikroTik operations disabled.

Hasil test terfokus:
- `pytest` (4 file hotspot/task terkait) → **passed**.

### D) Penerapan Cepat di Produksi (Immediate Remediation)

- Unauthorized sync manual apply dijalankan:
  - hasil: `processed_hosts=70`, `desired_block_ips=16`, `apply=True`.
- Enforce blok langsung untuk user `quota_debt_total_mb >= 500` (non-unlimited) dijalankan sekali:
  - hasil: `blocked=7`, `failed=0`.
  - nomor uji yang diminta (`+6283179074596`) terverifikasi **tidak termasuk kandidat block** (total debt = 0).

---

## Addendum 2026-02-26 (Policy Alignment Final: Auto Debt vs Manual Debt EOM)

Penyelarasan final mengikuti aturan operasional utama:

- Auto debt (`quota_debt_auto_mb`) tetap trigger blocked app-level saat melewati `QUOTA_DEBT_LIMIT_MB`,
  namun **tanpa** network hard-block (`ip-binding` tetap `regular`, address-list mengikuti status kuota normal).
- Manual debt yang belum lunas di akhir bulan menjadi satu-satunya jalur hard-block debt:
  `ip-binding=blocked` dan `address-list=blocked`.
- Status `habis` dan `expired` menggunakan `ip-binding=regular`.
- User unlimited dengan batas waktu tetap bisa `expired` jika waktunya habis; unlimited tanpa batas waktu tetap unlimited.

Perubahan kode:
- `backend/app/services/access_policy_service.py`
- `backend/app/services/hotspot_sync_service.py`
- `backend/app/tasks.py`

Regression tests:
- `backend/tests/test_hotspot_sync_debt_limit.py`
- `backend/tests/test_access_policy_block_rules.py`
- `backend/tests/test_hotspot_sync_address_list_status.py`
- `backend/tests/test_tasks_unauthorized_sync.py`
- status: **passed**

Dokumen acuan khusus policy ditambahkan:
- `docs/RULES_QUOTA_DEBT_ACCESS_FLOW.md`

---

## Addendum 2026-02-26 (Demo Payment-Only Hardening + Cleanup Produksi + Audit Runtime)

Batch ini menutup gap operasional pada mode demo agar benar-benar payment-only, sekaligus mencatat cleanup dan verifikasi pasca deploy di produksi.

### A) Hardening Backend (Demo Mode & Auth)

Perubahan utama:
- `backend/app/infrastructure/http/auth_contexts/otp_handlers.py`
  - request OTP untuk nomor whitelist demo ditolak (`403`) saat demo mode OFF.
- `backend/app/infrastructure/http/auth_routes.py`
  - helper demo mode dipisah tegas (enabled vs whitelist) untuk wiring handler yang eksplisit.
- `backend/app/services/hotspot_sync_service.py`
  - user demo di-skip dari sync periodik maupun sync single-user.
- `backend/app/services/device_management_service.py`
  - login sukses membersihkan address-list `blocked` dan `unauthorized`.

Tujuan hasil:
- demo tidak mengganggu state router,
- behavior ON/OFF demo konsisten,
- user authorized tidak tertahan stale list `unauthorized`.

### B) Hardening RBAC Admin (By-ID)

`backend/app/infrastructure/http/admin/user_management_routes.py` diperketat:
- endpoint by-id untuk target user kini memakai guard terpusat,
- admin non-super ditolak mengakses:
  - user `SUPER_ADMIN`,
  - user demo (deteksi berdasarkan whitelist nomor + fallback nama `Demo User...`).

### C) Test, Commit, dan Push

Commit utama batch hardening:
- `0757174b` — restrict demo flow to payment-only and decouple demo from MikroTik
- `0b674af3` — add admin general toggle for demo mode with runtime setting support
- `d619e5ec` — harden demo auth flows and skip MikroTik sync for demo users

Validasi terfokus yang dicatat:
- test OTP demo-disabled lulus,
- lint file backend terkait lulus.

### D) Cleanup Produksi Nomor Demo Spesifik

Eksekusi cleanup terarah untuk nomor `081234567890` pada environment produksi:
- hotspot user dihapus,
- entri terkait ip-binding/address-list dibersihkan,
- verifikasi pasca-aksi menunjukkan artefak target tidak ditemukan lagi.

### E) Deploy Produksi (`--prune`) dan Verifikasi

Deploy dilakukan via `deploy_pi.sh --prune`:
- stack service naik normal,
- health endpoint backend mengembalikan `pong`,
- readiness frontend terkonfirmasi.

### F) Audit Log Runtime 6 Menit (Backend + Celery)

Sampel monitoring pasca deploy:
- tidak ada traceback/error kritikal baru,
- celery beat dispatch task periodik normal (`sync_hotspot_usage_task`, `sync_unauthorized_hosts_task`),
- worker mengeksekusi task dengan status sukses,
- terdapat satu event info `global lock active` pada sync (dikategorikan proteksi overlap, bukan failure).

### G) Catatan Operasional Penting

- Menonaktifkan demo mode tidak menghapus data demo otomatis dari DB.
- Cleanup demo tetap tindakan manual terkontrol sesuai SOP.
- Dokumen SOP terpisah ditambahkan di `docs/DEMO_MODE_ADMIN_SOP.md`.
