# Redis Production Configuration untuk Raspberry Pi 4
# Optimized untuk performance dan memory efficiency

# Network
bind 0.0.0.0
port 6379
tcp-backlog 511
timeout 300
tcp-keepalive 300

# General
daemonize no
pidfile /var/run/redis_6379.pid
loglevel notice

# Memory Management - Optimized untuk Raspberry Pi 4
maxmemory 200mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# Persistence - Balanced untuk production
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# Append Only File - Disabled untuk performance pada hotspot portal
appendonly no

# Security (gunakan AUTH jika diperlukan)
# requirepass yourpasswordhere

# Clients
maxclients 100

# Slow Log
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency Monitoring
latency-monitor-threshold 100

# Database
databases 16

# Performance Tweaks untuk Raspberry Pi 4
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active Rehashing
activerehashing yes

# Client Output Buffer
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Client Query Buffer
client-query-buffer-limit 1gb

# Protocol
proto-max-bulk-len 512mb

# HyperLogLog
hll-sparse-max-bytes 3000

# Streams
stream-node-max-bytes 4096
stream-node-max-entries 100

# Lua
lua-time-limit 5000

# Hotspot Portal Specific
# Optimize untuk frequent IP/MAC lookups
# Keys dengan prefix "mikrotik_cache:" akan di-expire otomatis
# Keys dengan prefix "auth_cache:" akan di-expire otomatis

# ARM64 Raspberry Pi 4 Optimizations
jemalloc-bg-thread yes

# Replica/Replication (disabled untuk single instance)
# replicaof <masterip> <masterport>

# Module System (tidak diperlukan untuk hotspot portal)
# loadmodule /path/to/module.so

# Geoip (tidak diperlukan)
# geoip-db /usr/share/GeoIP/GeoIP.dat

# RDB-AOF Cross Replica (disabled)
aof-rewrite-incremental-fsync yes

# JSON (Redis Stack feature - tidak diperlukan)
# Gunakan hash untuk compatibility

# Monitoring dan Stats
info-commandstats-enabled yes

# Key Expiry Notifications (optional untuk debugging)
notify-keyspace-events ""

# Memory Usage Command (enable untuk monitoring)
memory-usage-sample-count 5
