# Override untuk development: mount source code backend ke container.
# Tujuan: perubahan Python langsung terbaca tanpa `--build`.
# Pakai dengan:
#   docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
# Catatan:
# - Gunicorn di-set `--reload` dengan polling agar kompatibel dengan mount di Docker Desktop (Windows).
# - Celery tidak auto-reload; restart container jika ubah kode yang dipakai worker/beat.

services:
  backend:
    volumes:
      - ./backend:/app
      - font_cache:/app/.cache
      - ./backend/backups:/app/backups
    command:
      - "gunicorn"
      - "--bind"
      - "0.0.0.0:5010"
      - "run:app"
      - "--reload"
      - "--reload-engine"
      - "poll"
      - "--workers=1"
      - "--timeout=60"
      - "--log-level=info"
      - "--access-logfile"
      - "-"
      - "--error-logfile"
      - "-"

  migrate:
    volumes:
      - ./backend:/app
      - font_cache:/app/.cache

  celery_worker:
    volumes:
      - ./backend:/app
      - font_cache:/app/.cache

  celery_beat:
    volumes:
      - ./backend:/app
      - font_cache:/app/.cache
