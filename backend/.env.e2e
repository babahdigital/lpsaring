# backend/.env.e2e
# Duplikat dari backend/.env.local untuk simulasi E2E lokal (docker-compose.e2e.yml)
# Jangan ubah backend/.env.local (dev). File ini khusus E2E.

APP_ENV=e2e
FLASK_APP=run.py
FLASK_ENV=development
FLASK_DEBUG=True

SECRET_KEY=584417b029085ae2ae252adea8bc91d24e3e2a6882467eaa3965c304484c39c7
JWT_SECRET_KEY=1d2a9ce48e0c2a9c2fdd0ef2170a27f862b9c7a6d58ffeb6dd3b3d2b6d6f7a4f

# Access token pendek (opsi B)
JWT_ACCESS_TOKEN_EXPIRES_MINUTES=30

# Auth cookie (HttpOnly) untuk access token
AUTH_COOKIE_MAX_AGE_SECONDS=1800
AUTH_COOKIE_SECURE=False

# Refresh token (rotating) untuk persistensi login
REFRESH_TOKEN_EXPIRES_DAYS=30
REFRESH_COOKIE_NAME=refresh_token
REFRESH_COOKIE_HTTPONLY=True
REFRESH_COOKIE_SECURE=False
REFRESH_COOKIE_SAMESITE=Lax
REFRESH_COOKIE_PATH=/
REFRESH_COOKIE_DOMAIN=
REFRESH_COOKIE_MAX_AGE_SECONDS=2592000
REFRESH_TOKEN_RATE_LIMIT=60 per minute

ENABLE_ADMIN_ROUTES=True

# --- Database (E2E) ---
DB_USER=hotspot_e2e_user
DB_PASSWORD=hotspot_e2e_password
DB_HOST=db
DB_PORT=5432
DB_NAME=hotspot_e2e_db
DATABASE_URL=postgresql+psycopg2://hotspot_e2e_user:hotspot_e2e_password@db:5432/hotspot_e2e_db

# --- Redis/Celery ---
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2

# --- Payment (dev/local) ---
MIDTRANS_SERVER_KEY=SB-Mid-server-IjnL8HGa6FfK1cbNLdrD5jtq
MIDTRANS_CLIENT_KEY=SB-Mid-client-ZRQkWJJFVv-8oZ40
MIDTRANS_IS_PRODUCTION=False

# --- WhatsApp ---
ENABLE_WHATSAPP_NOTIFICATIONS=False
WHATSAPP_API_URL=https://api.fonnte.com/send
WHATSAPP_VALIDATE_URL=https://api.fonnte.com/validate
WHATSAPP_API_KEY=dummy
WHATSAPP_HTTP_TIMEOUT_SECONDS=15
WHATSAPP_PDF_DOWNLOAD_TIMEOUT_SECONDS=20
WHATSAPP_SEND_DELAY_MIN_MS=400
WHATSAPP_SEND_DELAY_MAX_MS=1200
WHATSAPP_RATE_LIMIT_ENABLED=True
WHATSAPP_RATE_LIMIT_WINDOW_SECONDS=60
WHATSAPP_RATE_LIMIT_PER_TARGET=3
WHATSAPP_RATE_LIMIT_GLOBAL=120

# --- MikroTik (opsional; untuk E2E biasanya dimatikan dari script/settings) ---
MIKROTIK_HOST=10.10.83.1
MIKROTIK_USER=abdullah
MIKROTIK_PASSWORD=alhabsyi
MIKROTIK_PORT=8728
MIKROTIK_USE_SSL=False
MIKROTIK_DEFAULT_PROFILE=default
MIKROTIK_ACTIVE_PROFILE=profile-aktif
MIKROTIK_FUP_PROFILE=profile-fup
MIKROTIK_HABIS_PROFILE=profile-habis
MIKROTIK_UNLIMITED_PROFILE=profile-unlimited
MIKROTIK_EXPIRED_PROFILE=profile-expired
MIKROTIK_DEFAULT_SERVER_USER=testing
MIKROTIK_DEFAULT_SERVER_KOMANDAN=testing
MIKROTIK_KOMANDAN_PROFILE=profile-aktif
MIKROTIK_ADDRESS_LIST_ACTIVE=klient_aktif
MIKROTIK_ADDRESS_LIST_FUP=klient_fup
MIKROTIK_ADDRESS_LIST_INACTIVE=klient_inactive
MIKROTIK_ADDRESS_LIST_EXPIRED=klient_expired
MIKROTIK_ADDRESS_LIST_HABIS=klient_habis
MIKROTIK_ADDRESS_LIST_BLOCKED=klient_blocked

# Optional: stabilize client IP by making DHCP lease static (MAC -> IP).
MIKROTIK_DHCP_STATIC_LEASE_ENABLED=False

# Optional: pin lpsaring-managed DHCP static leases to a specific DHCP server name.
MIKROTIK_DHCP_LEASE_SERVER_NAME=

# Optional: if MAX_DEVICES_PER_USER reached, auto-replace one device on authenticated binding.
DEVICE_AUTO_REPLACE_ENABLED=False

# --- Hotspot policy knobs ---
IP_BINDING_ENABLED=True
IP_BINDING_TYPE_ALLOWED=bypassed
IP_BINDING_TYPE_BLOCKED=blocked
IP_BINDING_FAIL_OPEN=True
MAX_DEVICES_PER_USER=3
REQUIRE_EXPLICIT_DEVICE_AUTH=False
DEVICE_STALE_DAYS=30
WALLED_GARDEN_ENABLED=True
WALLED_GARDEN_ALLOWED_HOSTS=[]
WALLED_GARDEN_ALLOWED_IPS=["10.0.0.6-10.0.0.6"]
WALLED_GARDEN_MANAGED_COMMENT_PREFIX=lpsaring
WALLED_GARDEN_SYNC_INTERVAL_MINUTES=30
SYNC_ADDRESS_LIST_ON_LOGIN=True
SESSION_TOKEN_EXPIRE_SECONDS=120

# OTP bypass (E2E)
OTP_ALLOW_BYPASS=True
OTP_BYPASS_CODE=000000

# Rate limit detail (Flask-Limiter)
RATELIMIT_STRATEGY=fixed-window
RATELIMIT_ENABLED=True
API_RATE_LIMIT=100 per minute
OTP_REQUEST_RATE_LIMIT=5 per minute;20 per hour
OTP_VERIFY_RATE_LIMIT=10 per minute;60 per hour
ADMIN_LOGIN_RATE_LIMIT=10 per minute;60 per hour
REGISTER_RATE_LIMIT=5 per minute;20 per hour
SESSION_CONSUME_RATE_LIMIT=30 per minute
AUTO_LOGIN_RATE_LIMIT=60 per minute

# ProxyFix
PROXYFIX_X_FOR=1
PROXYFIX_X_PROTO=1
PROXYFIX_X_HOST=0
PROXYFIX_X_PORT=0
PROXYFIX_X_PREFIX=0
TRUST_CF_CONNECTING_IP=False
TRUSTED_PROXY_CIDRS=['127.0.0.1/32','10.0.0.0/8','172.16.0.0/12','192.168.0.0/16']

APP_TIMEZONE=Asia/Makassar

# URL untuk CSRF/trusted origins + link navigasi (E2E via nginx 8089)
FRONTEND_URL=http://localhost:8089
APP_PUBLIC_BASE_URL=http://localhost:8089
CORS_ADDITIONAL_ORIGINS=["http://localhost:8089","http://localhost:3011","http://localhost:3010","http://lpsaring.local"]
APP_LINK_USER=http://localhost:8089/login
APP_LINK_ADMIN=http://localhost:8089/admin
APP_LINK_ADMIN_CHANGE_PASSWORD=http://localhost:8089/akun
APP_LINK_MIKROTIK=http://login.lpsaring.local

# Super Admin init (opsional)
SUPERADMIN_PHONE=0811580039
SUPERADMIN_NAME=kecek
SUPERADMIN_PASSWORD=alhabsyi
