# backend/.env.local.example
# Template LOCAL (berisi secret / kredensial). Jangan commit backend/.env.local.

# --- Flask/app mode ---
APP_ENV=local
FLASK_APP=run.py
FLASK_ENV=development
FLASK_CONFIG=development
FLASK_DEBUG=True

# --- Optional toggles (non-secret) ---
SQLALCHEMY_ECHO=True
BACKUP_DIR=/app/backups
REDIS_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5

# --- Database (pilih salah satu) ---
# Opsi A (disarankan): DATABASE_URL
DATABASE_URL=postgresql+psycopg2://USER:PASSWORD@HOST:5432/DBNAME

# Opsi B (fallback kalau DATABASE_URL kosong)
DB_USER=
DB_PASSWORD=
DB_HOST=
DB_PORT=5432
DB_NAME=

# --- Secrets ---
SECRET_KEY=
JWT_SECRET_KEY=

# Access token pendek (opsi B)
JWT_ACCESS_TOKEN_EXPIRES_MINUTES=30

# Auth cookie (HttpOnly) untuk access token
AUTH_COOKIE_MAX_AGE_SECONDS=1800

# Refresh token (rotating) untuk persistensi login
REFRESH_TOKEN_EXPIRES_DAYS=30
REFRESH_COOKIE_NAME=refresh_token
REFRESH_COOKIE_HTTPONLY=True
REFRESH_COOKIE_SECURE=False
REFRESH_COOKIE_SAMESITE=Lax
REFRESH_COOKIE_PATH=/
REFRESH_COOKIE_DOMAIN=
REFRESH_COOKIE_MAX_AGE_SECONDS=2592000
REFRESH_TOKEN_RATE_LIMIT=60 per minute

# --- Dev-only convenience (optional) ---
# Jika SUPERADMIN_* di-set dan FLASK_ENV=development, backend akan auto-create SUPER_ADMIN bila belum ada.
SUPERADMIN_PHONE=
SUPERADMIN_NAME=
SUPERADMIN_PASSWORD=

# --- Redis (OTP / Celery / Rate limit) ---
REDIS_HOST_OTP=redis
REDIS_PORT_OTP=6379
REDIS_DB_OTP=0
REDIS_PASSWORD_OTP=

REDIS_HOST_CELERY_BROKER=redis
REDIS_PORT_CELERY_BROKER=6379
REDIS_DB_CELERY_BROKER=1
REDIS_PASSWORD_CELERY_BROKER=

REDIS_HOST_CELERY_BACKEND=redis
REDIS_PORT_CELERY_BACKEND=6379
REDIS_DB_CELERY_BACKEND=2
REDIS_PASSWORD_CELERY_BACKEND=

REDIS_HOST_RATELIMIT=redis
REDIS_PORT_RATELIMIT=6379
REDIS_DB_RATELIMIT=0
REDIS_PASSWORD_RATELIMIT=

RATELIMIT_STORAGE_URI=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2

# --- Payment (secret) ---
MIDTRANS_SERVER_KEY=
MIDTRANS_CLIENT_KEY=
MIDTRANS_IS_PRODUCTION=False

# --- WhatsApp (secret) ---
WHATSAPP_API_URL=https://api.fonnte.com/send
WHATSAPP_VALIDATE_URL=https://api.fonnte.com/validate
WHATSAPP_API_KEY=
WHATSAPP_PROVIDER=Fonnte
ENABLE_WHATSAPP_NOTIFICATIONS=True

# Rate limit WhatsApp (Redis)
WHATSAPP_RATE_LIMIT_ENABLED=True
WHATSAPP_RATE_LIMIT_WINDOW_SECONDS=60
WHATSAPP_RATE_LIMIT_PER_TARGET=3
WHATSAPP_RATE_LIMIT_GLOBAL=120

# --- MikroTik (secret) ---
MIKROTIK_HOST=
MIKROTIK_USER=
MIKROTIK_PASSWORD=
MIKROTIK_PORT=8728
MIKROTIK_USE_SSL=False
MIKROTIK_SSL_VERIFY=False
MIKROTIK_PLAIN_TEXT_LOGIN=True

# Optional: stabilize client IP by making DHCP lease static (MAC -> IP).
MIKROTIK_DHCP_STATIC_LEASE_ENABLED=False

# Optional: pin lpsaring-managed DHCP static leases to a specific DHCP server name.
MIKROTIK_DHCP_LEASE_SERVER_NAME=

# Optional: if MAX_DEVICES_PER_USER reached, auto-replace one device on authenticated binding
# (prioritize non-authorized devices, then oldest last_seen).
DEVICE_AUTO_REPLACE_ENABLED=False

# Profile hotspot (samakan dengan profile di MikroTik)
MIKROTIK_DEFAULT_PROFILE=default
MIKROTIK_ACTIVE_PROFILE=profile-aktif
MIKROTIK_FUP_PROFILE=profile-fup
MIKROTIK_HABIS_PROFILE=profile-habis
MIKROTIK_UNLIMITED_PROFILE=profile-unlimited
MIKROTIK_EXPIRED_PROFILE=profile-expired
MIKROTIK_BLOCKED_PROFILE=profile-blokir

# Address-list + IP binding policy
MIKROTIK_ADDRESS_LIST_ACTIVE=klient_aktif
MIKROTIK_ADDRESS_LIST_FUP=klient_fup
MIKROTIK_ADDRESS_LIST_INACTIVE=klient_inactive
MIKROTIK_ADDRESS_LIST_EXPIRED=klient_expired
MIKROTIK_ADDRESS_LIST_HABIS=klient_habis
MIKROTIK_ADDRESS_LIST_BLOCKED=klient_blocked
IP_BINDING_ENABLED=True
IP_BINDING_TYPE_ALLOWED=regular
IP_BINDING_TYPE_BLOCKED=blocked

# Sinkronisasi kuota
QUOTA_SYNC_INTERVAL_SECONDS=300
# Jika auto debt (used - purchased - auto_debt_offset) >= limit ini (MB):
# - app status blocked,
# - profile dipaksa ke MIKROTIK_BLOCKED_PROFILE,
# - address-list dipaksa ke MIKROTIK_ADDRESS_LIST_BLOCKED,
# - ip-binding tetap non-blocked (regular) untuk flow auto debt.
# Set 0 untuk mematikan fitur.
QUOTA_DEBT_LIMIT_MB=500
QUOTA_FUP_THRESHOLD_MB=3072
