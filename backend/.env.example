# backend/.env.example
# File ini adalah CONTOH/TEMPLATE. Salin ke .env dan isi nilai sebenarnya.
# JANGAN MASUKKAN NILAI ASLI (KUNCI API, PASSWORD) DI FILE INI.
# ================================================================

# Konfigurasi Aplikasi Flask
FLASK_APP=run.py
FLASK_ENV=development # Ganti ke 'production' saat deploy
FLASK_CONFIG=development # Pilih: development|production|testing (jika kosong, app memilih berdasarkan FLASK_ENV)
SECRET_KEY=ganti_dengan_kunci_rahasia_yang_sangat_kuat_dan_acak # WAJIB GANTI DI .env!
JWT_SECRET_KEY=ganti_dengan_kunci_jwt_yang_sangat_kuat_dan_acak # WAJIB GANTI DI .env!
JWT_ACCESS_TOKEN_EXPIRES_MINUTES=30
FLASK_DEBUG=True # Atur False di produksi
ENABLE_ADMIN_ROUTES=True

# Konfigurasi Database (sesuaikan dengan docker-compose/base.yml)
DB_USER=hotspot_user
DB_PASSWORD=changeme_db_password # WAJIB GANTI DI .env!
DB_HOST=db # Nama service di docker-compose
DB_PORT=5432
DB_NAME=hotspot_db
# Pastikan password di URL ini SAMA dengan DB_PASSWORD di atas saat mengisi .env
DATABASE_URL=postgresql+psycopg2://hotspot_user:changeme_db_password@db:5432/hotspot_db # WAJIB GANTI PASSWORD DI .env!
SQLALCHEMY_ECHO=False

# Konfigurasi Backup
BACKUP_DIR=/app/backups

# Konfigurasi Redis
REDIS_HOST_OTP=redis
REDIS_PORT_OTP=6379
REDIS_DB_OTP=0
REDIS_PASSWORD_OTP=
REDIS_HOST_CELERY_BROKER=redis
REDIS_PORT_CELERY_BROKER=6379
REDIS_DB_CELERY_BROKER=1
REDIS_PASSWORD_CELERY_BROKER=
REDIS_HOST_CELERY_BACKEND=redis
REDIS_PORT_CELERY_BACKEND=6379
REDIS_DB_CELERY_BACKEND=2
REDIS_PASSWORD_CELERY_BACKEND=
REDIS_HOST_RATELIMIT=redis
REDIS_PORT_RATELIMIT=6379
REDIS_DB_RATELIMIT=0
REDIS_PASSWORD_RATELIMIT=
RATELIMIT_STORAGE_URI=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1

# Redis client timeouts (opsional)
REDIS_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5

# === Kredensial Midtrans (Gunakan data Anda di file .env) ===
# Isi dengan Server Key Midtrans milik Anda
MIDTRANS_SERVER_KEY=SB-Mid-server-xxxxxxxxxxxxxxxxxxxxxxxx # <-- GANTI DI .env DENGAN SERVER KEY ANDA
# Isi dengan Client Key Midtrans milik Anda
MIDTRANS_CLIENT_KEY=SB-Mid-client-xxxxxxxxxxxxxxxxxxxxxxxx # <-- GANTI DI .env DENGAN CLIENT KEY ANDA
MIDTRANS_IS_PRODUCTION=False # Set True untuk mode produksi Midtrans
MIDTRANS_HTTP_TIMEOUT_SECONDS=15
MIDTRANS_WEBHOOK_IDEMPOTENCY_TTL_SECONDS=86400

# === Kredensial API WhatsApp Fonnte (Gunakan data Anda di file .env) ===
# Isi dengan API key WhatsApp provider yang Anda gunakan
WHATSAPP_API_URL=https://api.fonnte.com/send # Verifikasi URL ini jika Fonnte mengubahnya
WHATSAPP_VALIDATE_URL=https://api.fonnte.com/validate # Endpoint validasi nomor WhatsApp
WHATSAPP_API_KEY=xxxxxxxxxxxxxxxx # <-- GANTI DI .env DENGAN API KEY FONNTE ANDA
ENABLE_WHATSAPP_NOTIFICATIONS=True
WHATSAPP_HTTP_TIMEOUT_SECONDS=15
WHATSAPP_PDF_DOWNLOAD_TIMEOUT_SECONDS=20
WHATSAPP_SEND_DELAY_MIN_MS=400
WHATSAPP_SEND_DELAY_MAX_MS=1200

# WhatsApp anti-spam knobs (Redis best-effort + jitter)
WHATSAPP_RATE_LIMIT_ENABLED=True
WHATSAPP_RATE_LIMIT_WINDOW_SECONDS=60
WHATSAPP_RATE_LIMIT_PER_TARGET=3
WHATSAPP_RATE_LIMIT_GLOBAL=120

# Kredensial MikroTik (Isi sesuai konfigurasi MikroTik Anda)
MIKROTIK_HOST=192.168.88.1 # Ganti dengan IP/DNS MikroTik Anda
MIKROTIK_USER=admin_mikrotik
MIKROTIK_PASSWORD=password_mikrotik # Ganti dengan password MikroTik Anda
MIKROTIK_PORT=8728 # Port API default (8728 non-SSL, 8729 SSL)
MIKROTIK_USE_SSL=False # Set True jika Anda mengaktifkan & menggunakan API SSL di MikroTik
MIKROTIK_SSL_VERIFY=False
MIKROTIK_PLAIN_TEXT_LOGIN=True
MIKROTIK_DEFAULT_PROFILE=default
MIKROTIK_ACTIVE_PROFILE=profile-aktif
MIKROTIK_FUP_PROFILE=profile-fup
MIKROTIK_HABIS_PROFILE=profile-habis
MIKROTIK_UNLIMITED_PROFILE=profile-unlimited
MIKROTIK_EXPIRED_PROFILE=profile-expired
MIKROTIK_DEFAULT_SERVER_USER=srv-user
MIKROTIK_DEFAULT_SERVER_KOMANDAN=srv-komandan
MIKROTIK_KOMANDAN_PROFILE=profile-aktif
MIKROTIK_SEND_LIMIT_BYTES_TOTAL=False
MIKROTIK_SEND_SESSION_TIMEOUT=False
MIKROTIK_ADDRESS_LIST_ACTIVE=klient_aktif
MIKROTIK_ADDRESS_LIST_FUP=klient_fup
MIKROTIK_ADDRESS_LIST_INACTIVE=klient_inactive
MIKROTIK_ADDRESS_LIST_EXPIRED=klient_expired
MIKROTIK_ADDRESS_LIST_HABIS=klient_habis
MIKROTIK_ADDRESS_LIST_BLOCKED=klient_blocked
IP_BINDING_ENABLED=True
IP_BINDING_TYPE_ALLOWED=regular
IP_BINDING_TYPE_BLOCKED=blocked
HOTSPOT_BYPASS_STATUSES=['active','fup','unlimited']
IP_BINDING_FAIL_OPEN=False
MAX_DEVICES_PER_USER=3
REQUIRE_EXPLICIT_DEVICE_AUTH=True
DEVICE_STALE_DAYS=30
WALLED_GARDEN_ENABLED=False
WALLED_GARDEN_ALLOWED_HOSTS=[]
WALLED_GARDEN_ALLOWED_IPS=[]
WALLED_GARDEN_MANAGED_COMMENT_PREFIX=lpsaring
WALLED_GARDEN_SYNC_INTERVAL_MINUTES=30

# Optional: stabilize client IP by making DHCP lease static (MAC -> IP).
# Useful when firewall decisions rely on address-lists (IP-based) and clients roam/renew DHCP often.
MIKROTIK_DHCP_STATIC_LEASE_ENABLED=False

# Optional: if MAX_DEVICES_PER_USER reached, auto-replace one device on authenticated binding
# (OTP success or token_required endpoint like /users/me/devices/bind-current).
DEVICE_AUTO_REPLACE_ENABLED=False

# OTP bypass (development only)
OTP_ALLOW_BYPASS=False
OTP_BYPASS_CODE=000000
OTP_EXPIRE_SECONDS=300
SESSION_TOKEN_EXPIRE_SECONDS=120
SYNC_ADDRESS_LIST_ON_LOGIN=False
OTP_REQUEST_COOLDOWN_SECONDS=60
OTP_VERIFY_MAX_ATTEMPTS=5
OTP_VERIFY_WINDOW_SECONDS=300
OTP_FINGERPRINT_ENABLED=True

# Dev bypass untuk endpoint /api/users/me/* (development only)
DEV_BYPASS_USER_ENDPOINTS=False
DEV_BYPASS_USER_PHONE=
DEV_BYPASS_USER_ID=
DEV_BYPASS_TOKEN=

# Auth cookie (HttpOnly)
AUTH_COOKIE_NAME=auth_token
AUTH_COOKIE_HTTPONLY=True
AUTH_COOKIE_SECURE=False
AUTH_COOKIE_SAMESITE=Lax
AUTH_COOKIE_PATH=/
AUTH_COOKIE_DOMAIN=
AUTH_COOKIE_MAX_AGE_SECONDS=1800

# Refresh token (rotating) untuk persistensi login
REFRESH_TOKEN_EXPIRES_DAYS=30
REFRESH_COOKIE_NAME=refresh_token
REFRESH_COOKIE_HTTPONLY=True
REFRESH_COOKIE_SECURE=False
REFRESH_COOKIE_SAMESITE=Lax
REFRESH_COOKIE_PATH=/
REFRESH_COOKIE_DOMAIN=
REFRESH_COOKIE_MAX_AGE_SECONDS=2592000
REFRESH_TOKEN_RATE_LIMIT=60 per minute

# CSRF origin guard (cookie auth)
CSRF_PROTECT_ENABLED=True
CSRF_TRUSTED_ORIGINS=["http://localhost:3010"]
CSRF_STRICT_NO_ORIGIN=False
CSRF_NO_ORIGIN_ALLOWED_IPS=["10.10.83.1","10.10.83.2","10.0.0.6"]

# Sinkronisasi Kuota & Notifikasi
QUOTA_SYNC_INTERVAL_SECONDS=300
QUOTA_FUP_PERCENT=20
QUOTA_NOTIFY_PERCENTAGES=[20,10,5]
QUOTA_EXPIRY_NOTIFY_DAYS=[7,3,1]
INACTIVE_DEACTIVATE_DAYS=45
INACTIVE_DELETE_DAYS=90
AUTO_ENROLL_DEVICES_FROM_IP_BINDING=True
AUTO_ENROLL_DEBUG_LOG=False

# Kebijakan Permintaan Komandan
KOMANDAN_REQUEST_WINDOW_HOURS=24
KOMANDAN_REQUEST_MAX_PER_WINDOW=1
KOMANDAN_REQUEST_COOLDOWN_HOURS=6
KOMANDAN_ALLOW_UNLIMITED_REQUEST=True
KOMANDAN_MAX_QUOTA_MB=51200
KOMANDAN_MAX_QUOTA_DAYS=30
KOMANDAN_MAX_UNLIMITED_DAYS=30

# Pengaturan Lain
# Zona waktu aplikasi untuk format tanggal/jam
APP_LOCALE=id_ID.UTF-8
APP_TIMEZONE=Asia/Makassar
CURRENCY_SYMBOL=Rp 
JINJA_DATETIME_FORMAT=%d/%m/%y %H:%M
JINJA_DATETIME_SHORT_FORMAT=%b %d, %Y
LOG_TO_FILE=False
LOG_LEVEL=INFO
LOG_DIR=logs
LOG_FILENAME=hotspot_portal.log
LOG_MAX_BYTES=10485760
LOG_BACKUP_COUNT=5
LOG_FILE_LEVEL=INFO
LOG_FORMAT_JSON=True
LOG_IP_HEADER_DEBUG=False
LOG_BINDING_DEBUG=False
HOTSPOT_CLIENT_IP_CIDRS=['10.0.0.0/8','172.16.0.0/12','192.168.0.0/16']
# URL publik aplikasi yang dipakai untuk callback/redirect eksternal
APP_PUBLIC_BASE_URL=http://localhost:3010
# URL frontend yang bisa diakses backend (jika perlu)
FRONTEND_URL=http://localhost:3010
CORS_ADDITIONAL_ORIGINS=["http://localhost:3010"]
# URL aplikasi untuk user/admin
APP_LINK_USER=http://localhost:3010
APP_LINK_ADMIN=http://localhost:3010/admin
APP_LINK_MIKROTIK=http://192.168.88.1
APP_LINK_ADMIN_CHANGE_PASSWORD=http://localhost:3010/admin/account-settings
API_RATE_LIMIT=100 per minute # Contoh konfigurasi rate limit (akan digunakan oleh Flask-Limiter)
RATELIMIT_STRATEGY=fixed-window
RATELIMIT_ENABLED=True
PING_RATE_LIMIT=10 per minute
OTP_REQUEST_RATE_LIMIT=5 per minute;20 per hour
OTP_VERIFY_RATE_LIMIT=10 per minute;60 per hour
ADMIN_LOGIN_RATE_LIMIT=10 per minute;60 per hour
REGISTER_RATE_LIMIT=5 per minute;20 per hour
SESSION_CONSUME_RATE_LIMIT=30 per minute
AUTO_LOGIN_RATE_LIMIT=60 per minute
PUBLIC_SETTINGS_CACHE_TTL_SECONDS=300
METRICS_TTL_SECONDS=86400
TASK_DLQ_REDIS_KEY=celery:dlq
STATUS_PAGE_TOKEN_MAX_AGE_SECONDS=300
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RESET_SECONDS=60
CIRCUIT_BREAKER_HALF_OPEN_SUCCESS=2
PROXYFIX_X_FOR=1
PROXYFIX_X_PROTO=1
PROXYFIX_X_HOST=0
PROXYFIX_X_PORT=0
PROXYFIX_X_PREFIX=0
TRUST_CF_CONNECTING_IP=False
TRUSTED_PROXY_CIDRS=['127.0.0.1/32','10.0.0.0/8','172.16.0.0/12','192.168.0.0/16']

# Testing only
TEST_DATABASE_URL=

# Super Admin init (opsional)
SUPERADMIN_PHONE=0811xxxxxxx
SUPERADMIN_NAME=Super Admin
SUPERADMIN_PASSWORD=changeme123